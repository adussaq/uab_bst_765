var glob,globWork;!function(){"use strict";var e,n,a,t,s,i,o,r,l,m,p,d,u,h;u=amd_ww.startWorkers({filename:"js/math/normal_dist.min.js"}),h=amd_ww.startWorkers({filename:"js/math/mixed_norm.min.js"}),globWork=u,a=function(e){return e.reduce(function(e,n){return e+n})/e.length},l=function(e,n){return Math.round(e*Math.pow(10,n))/Math.pow(10,n)},i=function(e){return Math.max.apply(null,e)},o=function(e){return Math.min.apply(null,e)},t=function(e){var n=a(e);return e.map(function(e){return Math.pow(e-n,2)}).reduce(function(e,n){return e+n})/(e.length-1)},s=function(e,n,a,t,s){var i,o=[[],[]],r=[];for(console.log("running sim",a),i=0;e>i;i+=1)r.push(n.submit(a).then(function(e){o[0].push(e.mean),o[1].push(e.stdev)}));return Promise.all(r).then(function(){return{means:o[0],variances:o[1],simulations:e,trialsPerSim:a.samples,min:t,max:s}})},m=function(e,n,a,t){var s,i,o,r=[[],[],[],[],[],[]],l=[];for(console.log("running sim compare",a,t),s=0;e>s;s+=1)i=n.submit(a),o=n.submit(t),l.push(Promise.all([i,o]).then(function(e){var n=e[0].mean-e[1].mean,s=(e[0].stdev*(a.samples-1)+e[1].stdev*(t.samples-1))/(a.samples+t.samples-2);r[0].push(n),r[1].push(s),r[2].push(globalObject.t.dist(n/Math.sqrt(2*s/a.samples),a.samples+t.samples-2,!0)),a.hasOwnProperty("stdev")&&r[3].push(globalObject.t.dist(n/Math.sqrt(2*a.stdev/a.samples),a.samples+t.samples-2,!0))}));return Promise.all(l).then(function(){return{means:r[0],variances:r[1],simulations:e,sigs:r[2],sigs_std:r[3],trialsPerSim:a.samples,min:0,max:0}})},r=function(e){var n,a=[["label","value"]];for(n=0;n<e.length;n+=1)a.push(["d"+n,e[n]]);return a},d=function(e,n){var a,t,s,i;for(a=$("<table />",{"class":"table table-striped"}),n.append(a),a=$("<tbody />").appendTo(a),t=$("<tr />"),s=0;s<e[0].length;s+=1)t.append($("<th />",{html:e[0][s]}));for(a.append(t),s=1;s<e.length;s+=1){for(t=$("<tr />"),i=0;i<e[s].length;i+=1)t.append($("<td />",{html:e[s][i]}));a.append(t)}},p=function(e){n=$("#page"),n.append("<h3>"+e.simulations+" total simulations with "+e.trialsPerSim+" samples per simulation.</h3>"),d([["","Mean","Variance"],["Mean of Trials",l(a(e.means),5),l(t(e.means),5)],["Variance of Trials",l(a(e.variances),5),l(t(e.variances),5)]],n);var s="fig"+Math.random().toString().replace("0.","");n.append('<div id="'+s+'"></div>');var i={legend:{position:"none"},chartArea:{width:400},bar:{gap:0},histogram:{minValue:e.min,maxValue:e.max}},o=r(e.means),m=google.visualization.arrayToDataTable(o),p=new google.visualization.Histogram(document.getElementById(s));p.draw(m,i)},e=function(){var e,n=2e4,a=5;e=$("#page"),e.append("<p>So the goals here are to look at common lab practices of comparing two small groups and to show that I can simulate data utilizng the browser. These analyses will focus on comparing groups of 5 to each other, which is often a rather generous comparison.</p>"),e.append("<h2>Show that the normal distribution simulation works n(0,1)</h2>"),s(n,u,{samples:a,mean:0,stdev:1},-1,1).then(function(t){return p(t),e.append("<h2>Show what a mixed normal distribution simulation looks like 50/50 n(-0.5,1) / n(0.5,1)</h2>"),s(n,h,{samples:a,uniform:.5,mean1:-.5,stdev1:1,mean2:.5,stdev2:1},-1,1)}).then(function(t){return p(t),e.append("<h2>Show what a mixed normal distribution simulation looks like 80/20 n(0,1) / n(5,1)</h2>"),s(n,h,{samples:a,uniform:.8,mean1:0,stdev1:1,mean2:5,stdev2:1},-1,1)}).then(function(t){return p(t),e.append("<h2>Begin comparing 2 groups.</h2>"),e.append("<p>The goal here is to look at the small sample sizes used in many wet labs. I will be comparing two groups and looking at the success rate of using a normally distributed test and a t-test to compare these small groups.</p>"),e.append("<h3>Mean difference of a n(-.5,1) and n(.5, 1).</h3>"),m(n,u,{samples:a,mean:.5,stdev:1},{samples:a,mean:-.5,stdev:1})}).then(function(t){var s,i,o,r,l,d;return console.log(t),p(t),s=0,t.sigs.map(function(e){s+=e>.95?1:0}),i=0,t.sigs_std.map(function(e){i+=e>.95?1:0}),s/=t.means.length,i/=t.means.length,glob=t,l=globalObject.norm.dist(1/(1/Math.sqrt(a))+globalObject.norm.inv(.05,0,1),0,1,1),d=globalObject.t.dist(1/Math.sqrt(2/a)+globalObject.t.inv(.05,2*a-2,1),2*a-2,1),console.log(l,d,s,i,o,r),e.append("<p>Assuming a normal distribution we would expect that "+42.14483.toFixed(2)+"% of these simulations would produce significant (&alpha; < 0.05) differences. In this simulation we produced "+(100*s).toFixed(2)+"% significant differences calculating a pooled standard deviation for each trial and "+(100*i).toFixed(2)+"% assuming a standard deviation of one.</p>"),e.append("<p>This shows a bit how R generates is an overestimate. Or I am calculating this wrong. Just to check, lets look at 5,000 groups of 30 which should have 98.55% significant.</p>"),m(n/4,u,{samples:30,mean:.5,stdev:1},{samples:30,mean:-.5,stdev:1})}).then(function(t){p(t);var s,i;return s=0,t.sigs.map(function(e){s+=e>.95?1:0}),i=0,t.sigs_std.map(function(e){i+=e>.95?1:0}),s=s/t.means.length*100,i=i/t.means.length*100,console.log(s,i),e.append("<p>This produces "+s.toFixed(2)+"% significant without assuming the standard deviation and "+i.toFixed(2)+"% with assuming it to be 1. (98.55% expected). I am not sure how close I should be getting with these values.</p>"),e.append("<p>Finally I want to look at the difference of the power analyses of mixed normally distributed data and regular normal distributions assuming the same overall variance.</p>"),m(n,u,{samples:a,mean:.5,stdev:Math.sqrt(1.25)},{samples:a,mean:-.5,stdev:Math.sqrt(1.25)})}).then(function(t){p(t);var s,i;return s=0,t.sigs.map(function(e){s+=e>.95?1:0}),i=0,t.sigs_std.map(function(e){i+=e>.95?1:0}),s=s/t.means.length*100,i=i/t.means.length*100,console.log(s,i),e.append("<p>This produces "+s.toFixed(2)+"% significant without assuming the variance and "+i.toFixed(2)+"% with assuming it to be 1.25. The expected power is 36.30%.</p>"),e.append("<p>Now let us look at a the same mixed distribution as above with a mean difference of 1.</p>"),e.append("<h2>Show what a mixed normal distribution simulation looks like 50/50 n(-0.5,1) / n(0.5,1) with a mean difference of 1.</h2>"),m(n,h,{samples:a,uniform:.5,mean1:.5,stdev1:1,mean2:1.5,stdev2:1},{samples:a,uniform:.5,mean1:-.5,stdev1:1,mean2:.5,stdev2:1},-1,1)}).then(function(t){p(t),console.log(t);var s,i;return s=0,t.sigs.map(function(e){s+=e>.95?1:0}),s=s/t.means.length*100,console.log(s,i),e.append("<p>This produces "+s.toFixed(2)+"% significant without assuming the standard deviation.</p>"),m(n,u,{samples:a,mean:1,stdev:Math.sqrt(5)},{samples:a,mean:2,stdev:Math.sqrt(5)})}).then(function(t){p(t);var s,i;return s=0,t.sigs.map(function(e){s+=e>.95?1:0}),i=0,t.sigs_std.map(function(e){i+=e>.95?1:0}),s=s/t.means.length*100,i=i/t.means.length*100,console.log(s,i),e.append("<p>This produces "+s.toFixed(2)+"% significant without assuming the variance and "+i.toFixed(2)+"% with assuming it to be 5. The expected power is 15.95%.</p>"),e.append("<p>Now let us look at a the same mixed distribution as above with a mean difference of 1.</p>"),e.append("<h2>Show what a mixed normal distribution simulation looks like 80/20 n(0,1) / n(5,1) with a mean difference of 1.</h2>"),m(n,h,{samples:a,uniform:.8,mean1:1,stdev1:1,mean2:6,stdev2:1},{samples:a,uniform:.8,mean1:0,stdev1:1,mean2:5,stdev2:1},-1,1)}).then(function(n){p(n);var a,t;a=0,n.sigs.map(function(e){a+=e>.95?1:0}),a=a/n.means.length*100,console.log(a,t),e.append("<p>This produces "+a.toFixed(2)+"% significant without assuming the standard deviation.</p>")})},google.charts.setOnLoadCallback(e)}();