var dataArr=[];$.get("delaney/data.csv",function(t){dataArr=CSV.parse(t),console.log(dataArr),processData(JSON.parse(JSON.stringify(dataArr))),createPage()});var data={},header,timePoints=["0 Minutes","5 Minutes","10 Minutes","15 Minutes","20 Minutes","30 Minutes","40 Minutes","50 Minutes","60 Minutes","75 Minutes","90 Minutes","105 Minutes","120 Minutes"],condenseDataArr=function(){var t="",e=dataArr[0],i=dataArr[0];for(t+=i[0]+"	"+i[1]+"	"+i[2]+"	"+i[3]+"	"+i[4]+"	"+i[5]+"	"+i[6],t+="	7. Chronic Pain	8.Chronic Opiod Therapy	"+i[49]+"	10. Drug Given",n=54;n<i.length;n+=1)t+="	"+i[n];for(var r=1;r<dataArr.length;r+=1){if(i=dataArr[r],t+="\n"+i[0]+"	"+i[1]+"	"+i[2]+"	"+i[3]+"	"+i[4]+"	"+i[5]+"	"+i[6],i[7].match(/No/i))t+="	No";else{t+="	Yes";for(var n=8;27>n;n+=1)i[n].match(/^checked/i)&&(t+=", "+e[n].match(/choice=([\S\s]+)\)/i)[1]);""!==i[28]&&(t+=", "+i[28])}if(i[29].match(/No/i))t+="	No";else{for(t+="	Yes",n=30;47>n;n+=1)i[n].match(/^checked/i)&&(t+=", "+e[n].match(/choice=([\S\s]+)\)/i)[1]);""!==i[48]&&(t+=", "+i[48])}t+="	"+i[49];var o;for(t+="	",o=t.length,n=50;54>n;n+=1)i[n].match(/^checked/i)&&(t+=e[n].match(/choice=([^\(\)]+)/i)[1]+", ");for(o<t.length&&(t=t.match(new RegExp("^[\\S\\s]{"+(t.length-2)+"}","i"))[0]),n=54;83>n;n+=1)t+="	"+i[n];for(n=83;116>n;n+=1){var a=i[n];a&&"string"==typeof a&&(a=a.match(/\d{1,2}/),a=a.length?a[0]:0),t+="	"+a}for(n=116;125>n;n+=1)t+="	"+i[n]}return t},processData=function(t){header=t.shift();var e={};for(hi=0;hi<header.length;hi+=1)e.hasOwnProperty(header[hi])?(e[header[hi]]+=1,header[hi]+="_"+e[header[hi]]):e[header[hi]]=1;for(var i=0;i<t.length;i+=1){for(var r=t[i];data.hasOwnProperty(r[0]);)console.error("repeat: "+r[0]+". Was saved as repeat in ID#"),r[0]+="_newVisit";data[r[0]]={};for(var n=1;n<r.length;n+=1)data[r[0]][header[n]]=r[n]}return data},calcChangeFromStart=function(t){var e={};for(group in t){e[group]={points:{},ster:{},std:{},avg:{},total:{},count:{}},res=e[group];for(var i=0;i<timePoints.length;i+=1){for(pt in t[group]){tp1=timePoints[i],tp0=timePoints[0],tp=tp1,res.total.hasOwnProperty(tp)||(res.total[tp]=0,res.count[tp]=0,res.points[tp]=[]);var r=void 0,n=void 0,o=void 0;n=t[group][pt][tp1],"string"==typeof n&&(n=n.match(/\d{1,2}/)),o=t[group][pt][tp0],"string"==typeof o&&(o=o.match(/\d{1,2}/)),r=1*n-1*o,void 0!==r&&(r*=1,res.total[tp]+=r,res.count[tp]+=1,res.points[tp].push(r))}res.avg[tp]=res.total[tp]/res.count[tp],res.std[tp]=0;for(var a=0;a<res.points[tp].length;a+=1)res.std[tp]+=Math.pow(res.avg[tp]-res.points[tp][a],2)/(res.count[tp]-1);res.std[tp]=Math.sqrt(res.std[tp]),res.ster[tp]=res.std[tp]/Math.sqrt(res.count[tp])}}return e},calcSideScore=function(t){var e=["Changes in Hearing","Changes in Vision","Dizziness","Fatigue","Feeling of Unreality","Generalized Discomfort","Hallucination","Headache","Mood Change","Nausea"],i=["Changes in Hearing_2","Changes in Vision_2","Dizziness_2","Fatigue_2","Feeling of Unreality_2","Generalized Discomfort_2","Hallucination_2","Headache_2","Mood Change_2","Nausea_2"],r={};for(group in t){r[group]={points:{side1:[],side2:[]},std:{side1:0,side2:0},avg:{side1:0,side2:0},total:{side1:0,side2:0},count:{side1:0,side2:0}},res=r[group];var n=!1,o=!1;for(pt in t[group]){for(var a=0,s=0,p=0;p<e.length;p+=1)num=t[group][pt][e[p]],"string"==typeof num&&(num=num.match(/\d{1,2}/)),void 0!==num&&(a+=1*num,n=!0),num=t[group][pt][i[p]],"string"==typeof num&&(num=num.match(/\d{1,2}/)),void 0!==num&&(s+=1*num,o=!0);n&&o&&(res.total.side1+=a,res.count.side1+=1,res.points.side1.push(a),res.total.side2+=s,res.count.side2+=1,res.points.side2.push(s))}res.avg.side1=res.total.side1/res.count.side1,res.avg.side2=res.total.side2/res.count.side2,res.std.side1=0,res.std.side2=0;for(var d=0;d<res.points.side1.length;d+=1)res.std.side1+=Math.pow(res.avg.side1-res.points.side1[d],2)/(res.count.side1-1),res.std.side2+=Math.pow(res.avg.side2-res.points.side2[d],2)/(res.count.side2-1);res.std.side1=Math.sqrt(res.std.side1),res.std.side2=Math.sqrt(res.std.side2)}return r},drugGroups=function(t){groups={ketamine:{},dilaudid:{},morphine:{}};for(pt in t){var e=0;"Checked"===t[pt]["10. Was the patient given any of the following medication/s? (choice=Hydromorphine (Dilaudid) 1mg or 0.015mg/kg (Answer 10.b.))"]&&(groups.dilaudid[pt]=t[pt],e+=1),"Checked"===t[pt]["10. Was the patient given any of the following medication/s? (choice=Ketamine 0.15mg/kg  (Answer 10.a.))"]&&(groups.ketamine[pt]=t[pt],e+=1),"Checked"===t[pt]["10. Was the patient given any of the following medication/s? (choice=Morphine 0.1mg/kg  (Answer10.c.))"]&&(groups.morphine[pt]=t[pt],e+=1),e>1&&(console.error(pt+" is in multiple groups"),delete groups.dilaudid[pt],delete groups.ketamine[pt],delete groups.morphine[pt])}return groups},calcAvgs=function(t){var e,i={};for(group in t){i[group]={points:{},std:{},avg:{},total:{},count:{}},res=i[group];for(var r=0;r<timePoints.length;r+=1){for(pt in t[group])tp1=timePoints[r],tp=tp1,res.total.hasOwnProperty(tp)||(res.total[tp]=0,res.count[tp]=0,res.points[tp]=[]),e=t[group][pt][tp],"string"==typeof e&&(e=e.match(/\d{1,2}/)),void 0!==e&&(e*=1,res.total[tp]+=e,res.count[tp]+=1,res.points[tp].push(e));res.avg[tp]=res.total[tp]/res.count[tp],res.std[tp]=0;for(var n=0;n<res.points[tp].length;n+=1)res.std[tp]+=Math.pow(res.avg[tp]-res.points[tp][n],2)/(res.count[tp]-1);res.std[tp]=Math.sqrt(res.std[tp])/Math.sqrt(res.count[tp])}}return i},printavgs=function(t){var e=[[]],i=0;for(var r in t){e[0][i]=r;for(var n=0;n<timePoints.length;n+=1)e[n+1]?e[n+1][i]=t[r].avg[timePoints[n]]:(e[n+1]=[],e[n+1][i]=t[r].avg[timePoints[n]]);i+=1}var o="";for(n=0;n<e.length;n+=1)o+=e[n].join("	"),o+="\n";return console.log(o),o},groupsOpiods=function(t){var e={ketamineOp:{},dilaudidOp:{},morphineOp:{},ketamineNo:{},dilaudidNo:{},morphineNo:{}},i="10. Was the patient given any of the following medication/s? (choice=Hydromorphine (Dilaudid) 1mg or 0.015mg/kg (Answer 10.b.))",r="10. Was the patient given any of the following medication/s? (choice=Morphine 0.1mg/kg  (Answer10.c.))",n="10. Was the patient given any of the following medication/s? (choice=Ketamine 0.15mg/kg  (Answer 10.a.))",o="8.  Is the patient on chronic opioid therapy?";for(pt in t){var a=0;"Checked"===t[pt][i]&&(t[pt][o].match(/yes/i)?(e.dilaudidOp[pt]=t[pt],a+=1):t[pt][o].match(/no/i)&&(e.dilaudidNo[pt]=t[pt],a+=1)),"Checked"===t[pt][n]&&(t[pt][o].match(/yes/i)?(e.ketamineOp[pt]=t[pt],a+=1):t[pt][o].match(/no/i)&&(e.ketamineNo[pt]=t[pt],a+=1)),"Checked"===t[pt][r]&&(t[pt][o].match(/yes/i)?(e.morphineOp[pt]=t[pt],a+=1):t[pt][o].match(/no/i)&&(e.morphineNo[pt]=t[pt],a+=1)),a>1&&console.error(pt+" is in multiple groups")}return e},groupsGender=function(t){var e={ketamineMen:{},dilaudidMen:{},morphineMen:{},ketamineWo:{},dilaudidWo:{},morphineWo:{}},i="10. Was the patient given any of the following medication/s? (choice=Hydromorphine (Dilaudid) 1mg or 0.015mg/kg (Answer 10.b.))",r="10. Was the patient given any of the following medication/s? (choice=Morphine 0.1mg/kg  (Answer10.c.))",n="10. Was the patient given any of the following medication/s? (choice=Ketamine 0.15mg/kg  (Answer 10.a.))",o="3.  Gender:";for(pt in t){var a=0;"Checked"===t[pt][i]&&(t[pt][o].match(/^male/i)?(e.dilaudidMen[pt]=t[pt],a+=1):t[pt][o].match(/^female/i)&&(e.dilaudidWo[pt]=t[pt],a+=1)),"Checked"===t[pt][n]&&(t[pt][o].match(/^male/i)?(e.ketamineMen[pt]=t[pt],a+=1):t[pt][o].match(/^female/i)&&(e.ketamineWo[pt]=t[pt],a+=1)),"Checked"===t[pt][r]&&(t[pt][o].match(/^male/i)?(e.morphineMen[pt]=t[pt],a+=1):t[pt][o].match(/^female/i)&&(e.morphineWo[pt]=t[pt],a+=1)),a>1&&console.error(pt+" is in multiple groups")}return e},groupsRace=function(t){var e={ketamineW:{},dilaudidW:{},morphineW:{},ketamineNW:{},dilaudidNW:{},morphineNW:{}},i="10. Was the patient given any of the following medication/s? (choice=Hydromorphine (Dilaudid) 1mg or 0.015mg/kg (Answer 10.b.))",r="10. Was the patient given any of the following medication/s? (choice=Morphine 0.1mg/kg  (Answer10.c.))",n="10. Was the patient given any of the following medication/s? (choice=Ketamine 0.15mg/kg  (Answer 10.a.))",o="4.  Race:";for(pt in t){var a=0;"Checked"===t[pt][i]&&(t[pt][o].match(/white/i)?(e.dilaudidW[pt]=t[pt],a+=1):(e.dilaudidNW[pt]=t[pt],a+=1)),"Checked"===t[pt][n]&&(t[pt][o].match(/white/i)?(e.ketamineW[pt]=t[pt],a+=1):(e.ketamineNW[pt]=t[pt],a+=1)),"Checked"===t[pt][r]&&(t[pt][o].match(/white/i)?(e.morphineW[pt]=t[pt],a+=1):(e.morphineNW[pt]=t[pt],a+=1)),a>1&&console.error(pt+" is in multiple groups")}return e};