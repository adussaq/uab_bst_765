var glob,globWork,createPage,globRunner;!function(){"use strict";var e,t,n,o,i,a,r,s,l;r=amd_ww.startWorkers({filename:"js/math/bootstrap_worker.min.js"}),globRunner=r,e=function(e){return e.reduce(function(e,t){return e+t})/e.length},i=function(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)},n=function(e){return Math.max.apply(null,e)},o=function(e){return Math.min.apply(null,e)},t=function(t){var n=e(t);return t.map(function(e){return Math.pow(e-n,2)}).reduce(function(e,t){return e+t})/(t.length-1)},a=function(){var e,t,n,o,i,a,l,p,n;e=$("#page1"),l=drugGroups(data),p=calcAvgs(l),o=["dilaudid","morphine","ketamine"],t=["0 Minutes","5 Minutes","10 Minutes","15 Minutes","20 Minutes","30 Minutes","40 Minutes","50 Minutes","60 Minutes","75 Minutes","90 Minutes","105 Minutes","120 Minutes"],n=o.map(function(e){return t.map(function(t){return p[e].points[t].map(function(e){return[1*t.replace(/\D+/g,""),e]})}).reduce(function(e,t){return e.concat(t)})}),console.log("Here on the page..."),e.append('<div class="col-xs-12"><p><strong>Basic information:</strong> Group 0 (Dilaudid) has 31 patients, group 1 (Morphine) has 82 patients, and group 2 (Ketamine) has 46 patients. 4 patients were excluded from the subsequent study due to recieving multiple drugs.</p></div><div class="col-sm-10 col-sm-offset-1"><p><strong>154844.4286</strong> Has a history of abdominal chronic pain being treated with opiods, was given both morphine and ketamine, it is unclear when the morphine was given. This patient was eventually admitted.<p><p><strong>174096.8571</strong> Has a history of chronic sickle cell and back pain being treated chroniclly with opoids, was given both ketamine and dilaudid at various uncertian times, the patient was eventually admitted.</p><p><strong>270304</strong> Has a history of chronic pain, crohn\'s disease, chronic pancreatitis and is being treated chroniclly with methodone. The pateint was treated acutely with dilaudid, Lorazepam, and morphine and was discharged.</p><p><strong>333010.5714</strong> Has no history of chronic pain, is in for painful skin abscesses. The patient was given ketamine then dilaudid at 14 and 15 minute time points possibly due to a spontaneous subjective experience and was eventually admitted.</p></div>'),console.log(n),a=boxplotscatterdata(n[0].map(function(e){return e[0]}),n[0].map(function(e){return e[1]})),console.log(a),e.append('<div class="text-center col-xs-12"><div id="bplot1"></div></div>'),i=new google.visualization.ComboChart(document.getElementById("bplot1")),a.google_options.title="Dilaudid Pain Scores, 31 patients, box and wisker plot where the box represents the quartiles and the wiskers are the maximum and minimum. The red point is the averate at each time point.",i.draw(a.google_data,a.google_options),a=boxplotscatterdata(n[1].map(function(e){return e[0]}),n[1].map(function(e){return e[1]})),console.log(a),e.append('<div class="text-center col-xs-12"><div id="bplot2"></div></div>'),i=new google.visualization.ComboChart(document.getElementById("bplot2")),a.google_options.title="Morphine Pain Scores, 82 patients, box and wisker plot where the box represents the quartiles and the wiskers are the maximum and minimum. The red point is the averate at each time point.",i.draw(a.google_data,a.google_options),a=boxplotscatterdata(n[2].map(function(e){return e[0]}),n[2].map(function(e){return e[1]})),console.log(a),e.append('<div class="text-center col-xs-12"><div id="bplot3"></div></div>'),i=new google.visualization.ComboChart(document.getElementById("bplot3")),a.google_options.title="Ketamine Pain Scores, 46 patients, box and wisker plot where the box represents the quartiles and the wiskers are the maximum and minimum. The red point is the averate at each time point.",i.draw(a.google_data,a.google_options),e.append('<div class="col-xs-12"><p>So, we can see the same sort of pattern just looking at the means, the dose rather quickly decreases the average pain, then levels off over the two hours of recording pain scores. The interesting point here comes from looking at the medians. They respond similarly to the means, but lower less quickly. This is likely due to the number of 10\'s artificially inflating the early mean. Most interestingly of all, the ketamine eventual drops off to no pain at all for 50% of the pateints. This indicates that for the patients that Ketamine works, it works well.</p><p>From here lets look at the change in pain scores from time 0.</p></div>'),e=$("#page2");var d=calcChangeFromStart(l);n=o.map(function(e){return t.map(function(t){return d[e].points[t].map(function(e){return[1*t.replace(/\D+/g,""),e]})}).reduce(function(e,t){return e.concat(t)})}),a=boxplotscatterdata(n[0].map(function(e){return e[0]}),n[0].map(function(e){return e[1]})),console.log(a),e.append('<div class="text-center col-xs-12"><div id="bplot4"></div></div>'),i=new google.visualization.ComboChart(document.getElementById("bplot4")),a.google_options.title="Change in Dilaudid Pain Scores from Time 0",i.draw(a.google_data,a.google_options),a=boxplotscatterdata(n[1].map(function(e){return e[0]}),n[1].map(function(e){return e[1]})),console.log(a),e.append('<div class="text-center col-xs-12"><div id="bplot5"></div></div>'),i=new google.visualization.ComboChart(document.getElementById("bplot5")),a.google_options.title="Change in Morphine Pain Scores from Time 0",i.draw(a.google_data,a.google_options),a=boxplotscatterdata(n[2].map(function(e){return e[0]}),n[2].map(function(e){return e[1]})),console.log(a),e.append('<div class="text-center col-xs-12"><div id="bplot6"></div></div>'),a.google_options.title="Change in Ketamine Pain Scores from Time 0",i=new google.visualization.ComboChart(document.getElementById("bplot6")),i.draw(a.google_data,a.google_options),e.append('<div class="col-xs-12"><p>Looking at this data we see a slow trend downward in median pain score changes for Dilaudid and Morphine. However Ketamine presents an odd difference. It appears to trend identically to the other drug choices before plummeting to -7/-8 region in the end. Bootstrapping will give us an idea of the confidence we can place in these measures.</p><p>Now we are going to attempt to bootstrap these parameters to define confidence intervals for the Q1, Q2, Q3, and the mean. We will use 2000 bootstrap distributions, all sampled at 100% for each time point and each condition.</p></div>'),function(){var e,n,a,l,d,c=[];for(e=0;e<o.length;e+=1)for(a=p[o[e]].points,c[e]=[],console.log("working on pain score conf intervals",a),d=t,n=0;n<d.length;n+=1)l=a[d[n]],r.submit({data:l,straps:5e3,start:{time_point:n,drug:e},p_val:.2,p_val2:.05}).then(function(e){c[e.start.drug][e.start.time_point]=e.CI});$(".hidden_here").show(),r.all().then(function(){var e,n;e=$("#page3"),n=s(c.map(function(e){return e.map(function(e){return e.mean})}),t.map(function(e){return 1*e.replace(/\D+/g,"")}),o),e.append('<div id="meanPain" class="text-center col-xs-12"><div id="plot10"></div></div>'),n.google_options.vAxis={viewWindow:{min:0,max:10}},n.google_options.title="Comparison of Mean Pain Scores. Utilizes a 5000 repitition bootstrap to generate an 80% confidence intervals.",i=new google.visualization.ComboChart(document.getElementById("plot10")),i.draw(n.google_data,n.google_options),$("#meanPain").append(n.table),$("#meanPain").append("<p>This figure shows us that from start to finish the patients given ketamine have lower pain scores, reaching some level of significant both early on and late in the experiment. We have an interesting early dip in pain that produces a 95% confidence of rejecting the null hypothesis that the pain scores are identical.</p>"),n=s(c.map(function(e){return e.map(function(e){return e.Q2})}),t.map(function(e){return 1*e.replace(/\D+/g,"")}),o),e.append('<div id="interval2" class="text-center col-xs-12"><div id="plot11"></div></div>'),i=new google.visualization.ComboChart(document.getElementById("plot11")),n.google_options.vAxis={viewWindow:{min:0,max:10}},n.google_options.title="Comparison of Median Pain Scores. Utilizes a 5000 repitition bootstrap to generate an 80% confidence intervals.",i.draw(n.google_data,n.google_options),$("#interval2").append(n.table),$("#interval2").append("<p>In order to make values slightly different to deal with the integer nature of this data, a uniform random [-0.05, 0.05) is added to each sample during each bootstrap process. This allows us to deal with what would otherwise be segments ending on the same integer value and in theory will give us an idea of where we are in a block of equal values. We can see that this measure rejects the null towards the end of the time period.</p>"),n=s(c.map(function(e){return e.map(function(e){return e.Q3})}).concat(c.map(function(e){return e.map(function(e){return e.Q1})})),t.map(function(e){return 1*e.replace(/\D+/g,"")}),o),e.append('<div id="interval3" class="text-center col-xs-12"><div id="plot12"></div></div>'),i=new google.visualization.ComboChart(document.getElementById("plot12")),n.google_options.vAxis={viewWindow:{min:0,max:10}},n.google_options.title="Comparison of First and Third Quartile Pain Scores. Utilizes a 5000 repitition bootstrap to generate an 80% confidence intervals.",i.draw(n.google_data,n.google_options),$("#interval3").append(n.table),$("#interval3").append('<p>The point here is to look at how well "responders" versus "non-responders" react to the treatment. This is being modeled by looking at the quartiles Q1 and Q3. Q3, the "non-responders" reject the null in the middle of the experiment for a comparison of dilaudid and morphine, but otherwise all differences are non-significant. Q1, or the "responders" rejects the null when comparing ketamine to other choices early on post treatment, then again towards the end of the time frame. This pattern distinguishes ketamine from dilaudid.</p>'),console.log("All Done!",c)})}(),function(){var e,n,a,l,p,c=[];for(e=0;e<o.length;e+=1)for(a=d[o[e]].points,c[e]=[],console.log(a),p=t,n=0;n<p.length;n+=1)l=a[p[n]],r.submit({data:l,straps:5e3,start:{time_point:n,drug:e},p_val:.2,p_val2:.05}).then(function(e){c[e.start.drug][e.start.time_point]=e.CI,console.log(e)});$(".hidden_here").show(),r.all().then(function(){var e,n;e=$("#page3"),e.append("<h4>To look more closely patient by patient we compare the change in self reported pain from the first recorded values.</h4>"),n=s(c.map(function(e){return e.map(function(e){return e.mean})}),t.map(function(e){return 1*e.replace(/\D+/g,"")}),o),e.append('<div id="interval4" class="text-center col-xs-12"><div id="plot7"></div></div>'),n.google_options.vAxis={viewWindow:{min:-10,max:1}},n.google_options.title="Comparison of Mean Change in Pain Scores from Time 0. Utilizes a 5000 repitition bootstrap to generate an 80% confidence intervals.",i=new google.visualization.ComboChart(document.getElementById("plot7")),i.draw(n.google_data,n.google_options),$("#interval4").append(n.table),$("#interval4").append("<p>We can see the middle section of this analysis ketamine is being out performed by the other two drug choices. This observation is repeated in the median value.</p>"),n=s(c.map(function(e){return e.map(function(e){return e.Q2})}),t.map(function(e){return 1*e.replace(/\D+/g,"")}),o),e.append('<div id="interval5" class="text-center col-xs-12"><div id="plot8"></div></div>'),i=new google.visualization.ComboChart(document.getElementById("plot8")),n.google_options.vAxis={viewWindow:{min:-10,max:1}},n.google_options.title="Comparison of Median Change in Pain Scores from Time 0. Utilizes a 5000 repitition bootstrap to generate an 80% confidence intervals.",i.draw(n.google_data,n.google_options),$("#interval5").append(n.table),n=s(c.map(function(e){return e.map(function(e){return e.Q3})}).concat(c.map(function(e){return e.map(function(e){return e.Q1})})),t.map(function(e){return 1*e.replace(/\D+/g,"")}),o),e.append('<div id="interval6" class="text-center col-xs-12"><div id="plot9"></div></div>'),i=new google.visualization.ComboChart(document.getElementById("plot9")),n.google_options.vAxis={viewWindow:{min:-10,max:1}},n.google_options.title="Comparison of First and Third Quartile Change in Pain Scores from Time 0. Utilizes a 5000 repitition bootstrap to generate an 80% confidence intervals.",i.draw(n.google_data,n.google_options),$("#interval6").append(n.table),$("#interval6").append("<p>In this figure I think we see why the drug response is what it is. Our non-responders are either getting worse or not improving on ketamine. In contrast our responder group rejects the null towards the end of the experiment with ketamine response out performing both diaudid and morphine at various points.</p>")})}()},s=function(e,t,n){var o,i,a,r,s,p,d,c,u,g,h,m,f,v,w,b,x,_=[],y=[];for(d=new google.visualization.DataTable,d.addColumn("number","time"),y[0]=["</th><th>CI"],a=0;a<e.length;a+=1)for(c=0,d.addColumn("number",n[a%n.length]),y.push([n[a%n.length]]),c+=1,s=0;2>s;s+=1)d.addColumn({id:"i"+s+2*a,type:"number",role:"interval"}),c+=1;for(a=0;a<e.length;a+=1)for(s=0;s<t.length;s+=1){for(u=[t[s]],y[0][s+1]=t[s],p=0;c*a>p;p+=1)u.push(null);for(u.push(e[a][s].median),u.push(e[a][s].CI_min),u.push(e[a][s].CI_max),p=u.length-1;p<c*e.length;p+=1)u.push(null);_.push(u),y[a+1][s+1]=[[e[a][s].CI_min,e[a][s].CI_max],[e[a][s].CI2_min,e[a][s].CI2_max]]}d.addRows(_);var C={curveType:"linear",intervals:{style:"area"},height:400,lineWidth:2};for(g=$("<table>",{"class":"table table-striped"}),g.append($("<thead>").append($("<tr>").append($(y.shift().map(function(e){return"<th>"+e+" min</th>"}).join(""))))),f=$("<tbody>"),g.append(f),v={80:[],95:[],"80s":[],"95s":[]},a=0;a<y.length;a+=1){for(o="80",i="95",a>n.length-1&&(o="80s",i="95s"),h=y[a].shift(),m=$("<tr>"),m.append($("<th>"+h+"</th>")),m.append($("<th>80%<br />95%</th>")),s=0;s<y[a].length;s+=1)r=Math.random().toString().replace("0.",""),v[o][s]=v[o][s]||[],v[i][s]=v[i][s]||[],x=$("<td>"),w=$("<div>",{text:"("+y[a][s][0][0].toFixed(2)+","+y[a][s][0][1].toFixed(2)+")"}),b=$("<div>",{text:"("+y[a][s][1][0].toFixed(2)+","+y[a][s][1][1].toFixed(2)+")"}),x.append(w),x.append(b),m.append(x),function(e,t){v[o][s].push([y[a][s][0][0]+15,y[a][s][0][1]+15,e]),v[i][s].push([y[a][s][1][0]+15,y[a][s][1][1]+15,t])}(w,b);f.append(m)}return Object.keys(v).map(function(e){v[e].map(function(e){l(e)})}),{google_data:d,google_options:C,table:g}},l=function(e){var t,n;for(t=0;t<e.length;t+=1)for(n=t+1;n<e.length;n+=1)e[t][0]<e[n][1]&&e[n][0]<e[t][1]||(e[t][2].css("color","red"),e[n][2].css("color","red"))},createPage=function(){google.charts.setOnLoadCallback(a)}}();